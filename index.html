<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Escolha seu Personagem - Festa do Jp</title>
    
    <style>
        /* --- CSS (ESTILO VISUAL) --- */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #1a1a1a; color: #f0f0f0; padding: 15px; line-height: 1.6; }
        header { text-align: center; margin-bottom: 30px; padding: 10px; }
        h1 { color: #00bcd4; font-size: 1.8rem; margin-bottom: 10px; }
        h2.subtitle { font-size: 1rem; color: #ccc; font-weight: normal; }
        #character-selection { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; max-width: 1200px; margin: 0 auto; padding-bottom: 40px; }
        .character-card { background-color: #2c2c2c; border-radius: 12px; padding: 15px; text-align: center; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4); transition: transform 0.2s ease-in-out, box-shadow 0.2s; display: flex; flex-direction: column; justify-content: space-between; }
        .character-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5); }
        .character-card img { width: 100%; height: 420px; object-fit: cover; object-position: top center; border-radius: 8px; margin-bottom: 15px; }
        .character-card h2 { color: #ffeb3b; font-size: 1.4rem; margin-bottom: 5px; }
        .character-card h3 { font-size: 0.95rem; color: #00bcd4; margin-bottom: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }
        .character-card p { font-style: italic; color: #bbb; margin-bottom: 20px; font-size: 0.9rem; flex-grow: 1; }
        
        /* BOTÕES */
        .choose-button { background-color: #4caf50; color: white; border: none; padding: 15px 20px; border-radius: 8px; cursor: pointer; font-size: 1rem; font-weight: bold; width: 100%; transition: background-color 0.2s, transform 0.1s; }
        .choose-button:hover:not(:disabled) { background-color: #43a047; }
        .choose-button:active:not(:disabled) { transform: scale(0.98); }
        /* Estilo para botão JÁ ESCOLHIDO (Cinza) */
        .choose-button:disabled { background-color: #555 !important; color: #aaa !important; cursor: not-allowed; border: 1px solid #444; }

        @media (min-width: 768px) {
            h1 { font-size: 2.5rem; }
            .character-card img { height: 450px; }
            body { padding: 40px; }
        }
    </style>
</head>
<body>

    <header>
        <h1>Confirme sua presença na maior festa da cidade!!</h1>
        <h2 class="subtitle">Escolha seu personagem sabiamente, não vale pegar o que alguém já pegou hein - Jp</h2>
    </header>

    <main id="character-selection">
        
        <div class="character-card" data-id="1">
            <h2>Gary Amaral</h2>
            <img src="imgs/personagem1.jpg" alt="Personagem 1">
            <h3>O roqueiro popularzinho</h3>
            <p>“Se tiver música boa, eu tô dentro.”</p>
            <button class="choose-button" data-pdf="fichas/ficha_personagem1.pdf">Escolher</button>
        </div>

        <div class="character-card" data-id="2">
            <h2>Rafael Borges</h2>
            <img src="imgs/personagem2.jpg" alt="Personagem 2">
            <h3>O esportista palmeirense</h3>
            <p>“PARMEEEEERAAAAAAAA.”</p>
            <button class="choose-button" data-pdf="fichas/ficha_personagem2.pdf">Escolher</button>
        </div>

        <div class="character-card" data-id="3">
            <h2>Kevin Tavares</h2>
            <img src="imgs/personagem3.jpg" alt="Personagem 3">
            <h3>O roqueiro esquisito</h3>
            <p>“EI, eu não sou esquisito, quem escreveu essa porcaria?”</p>
            <button class="choose-button" data-pdf="fichas/ficha_personagem3.pdf">Escolher</button>
        </div>

        <div class="character-card" data-id="4">
            <h2>Larissa Mendes</h2>
            <img src="imgs/personagem4.jpg" alt="Personagem 4">
            <h3>A estudiosa</h3>
            <p>“Organização é tudo. Sempre.”</p>
            <button class="choose-button" data-pdf="fichas/ficha_personagem4.pdf">Escolher</button>
        </div>

        <div class="character-card" data-id="5">
            <h2>Marcela Duarte</h2>
            <img src="imgs/personagem5.jpg" alt="Personagem 5">
            <h3>A parceira de estudos da Lari</h3>
            <p>“Se você precisar, eu anoto. Eu sempre anoto tudo.”</p>
            <button class="choose-button" data-pdf="fichas/ficha_personagem5.pdf">Escolher</button>
        </div>

        <div class="character-card" data-id="6">
            <h2>Júlia Fontes</h2>
            <img src="imgs/personagem6.jpg" alt="Personagem 6">
            <h3>A nerd popularzinha</h3>
            <p>“Pois é, só tira essa mão SUJA de perto do meu cabelo”</p>
            <button class="choose-button" data-pdf="fichas/ficha_personagem6.pdf">Escolher</button>
        </div>

        <div class="character-card" data-id="7">
            <h2>Olívia Salles</h2>
            <img src="imgs/personagem7.jpg" alt="Personagem 7">
            <h3>A esquisita da computação</h3>
            <p>“Eu funciono melhor com fone no ouvido e café na mão.”</p>
            <button class="choose-button" data-pdf="fichas/ficha_personagem7.pdf">Escolher</button>
        </div>

        <div class="character-card" data-id="8">
            <h2>Ryan Nunes</h2>
            <img src="imgs/personagem8.jpg" alt="Personagem 8">
            <h3>Melhor amigo da Salles, e tão nerd quanto!</h3>
            <p>“Eu preferia continuar em casa jogando Minecraft”</p>
            <button class="choose-button" data-pdf="fichas/ficha_personagem8.pdf">Escolher</button>
        </div>

        <div class="character-card" data-id="9">
            <h2>Ary Carvalho</h2>
            <img src="imgs/personagem9.jpg" alt="Personagem 9">
            <h3>O NB popular famosinho</h3>
            <p>“Achou que eu ia ficar de fora? Jurou né?”</p>
            <button class="choose-button" data-pdf="fichas/ficha_personagem9.pdf">Escolher</button>
        </div>

        <div class="character-card" data-id="10">
            <h2>Bruno Santana</h2>
            <img src="imgs/personagem10.jpg" alt="Personagem 10">
            <h3>O Gêmeo que precisou levar o irmão</h3>
            <p>“Tudo eu nessa casa”</p>
            <button class="choose-button" data-pdf="fichas/ficha_personagem10.pdf">Escolher</button>
        </div>

        <div class="character-card" data-id="11">
            <h2>Dennis Santana</h2>
            <img src="imgs/personagem11.jpg" alt="Personagem 11">
            <h3>O Gêmeo que preferia ter ficado em casa</h3>
            <p>“Eu realmente não precisava estar aqui.”</p>
            <button class="choose-button" data-pdf="fichas/ficha_personagem11.pdf">Escolher</button>
        </div>

        <div class="character-card" data-id="12">
            <h2>André Lacerda</h2>
            <img src="imgs/personagem12.jpg" alt="Personagem 12">
            <h3>O encrenqueiro que leva as bebidas</h3>
            <p>“Nada que um corote meio quente não resolva”</p>
            <button class="choose-button" data-pdf="fichas/ficha_personagem12.pdf">Escolher</button>
        </div>

    </main>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <script>
        // --- SUAS CONFIGURAÇÕES REAIS ---
        const firebaseConfig = {
            apiKey: "AIzaSyDSCGoUN1ZKYTUi3cpoc4dI1fPZavu3xhI",
            authDomain: "afestaacabou-6b2f7.firebaseapp.com",
            databaseURL: "https://afestaacabou-6b2f7-default-rtdb.firebaseio.com",
            projectId: "afestaacabou-6b2f7",
            storageBucket: "afestaacabou-6b2f7.firebasestorage.app",
            messagingSenderId: "47826000216",
            appId: "1:47826000216:web:ff3028fb5333e48e24ad2d"
        };

        // Inicializa o Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.database();

        document.addEventListener('DOMContentLoaded', () => {
            const buttons = document.querySelectorAll('.choose-button');

            const setButtonState = (btn, isTaken) => {
                if (isTaken) {
                    btn.textContent = 'JÁ ESCOLHIDO';
                    btn.disabled = true;
                } else {
                    btn.textContent = 'ESCOLHER';
                    btn.disabled = false;
                }
            };

            buttons.forEach(button => {
                const card = button.closest('.character-card');
                const charId = card.dataset.id;
                const charRef = db.ref('personagens/' + charId);

                // 1. OUVINTE EM TEMPO REAL (Atualiza sozinho)
                charRef.on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data && data.escolhido === true) {
                        setButtonState(button, true);
                    } else {
                        setButtonState(button, false);
                    }
                });

                // 2. CLIQUE PARA ESCOLHER
                button.addEventListener('click', (event) => {
                    const pdfPath = event.target.dataset.pdf;

                    charRef.transaction((currentData) => {
                        if (currentData && currentData.escolhido) {
                            return; // Já era, aborta!
                        }
                        return { escolhido: true }; // Marca como meu
                    }, (error, committed, snapshot) => {
                        if (error) {
                            alert('Erro de conexão com o banco de dados!');
                        } else if (!committed) {
                            alert('Putz! Alguém clicou milissegundos antes de você!');
                        } else {
                            alert('Personagem garantido! Baixando ficha...');
                            const link = document.createElement('a');
                            link.href = pdfPath;
                            link.download = pdfPath.split('/').pop();
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                        }
                    });
                });
            });
        });
    </script>
</body>
</html>