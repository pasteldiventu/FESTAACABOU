<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Escolha seu Personagem - Festa do Jp</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Raleway:wght@300;400;700&display=swap" rel="stylesheet">

    <style>
        /* --- CSS (ESTILO VISUAL RETRO NEON) --- */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body { 
            font-family: 'Raleway', sans-serif; 
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e); /* Gradiente Roxo Dark */
            color: #f0f0f0; 
            padding: 20px; 
            line-height: 1.6;
            min-height: 100vh;
        }

        header { text-align: center; margin-bottom: 50px; padding: 10px; }
        
        /* TÍTULOS NEON */
        h1 { 
            font-family: 'Orbitron', sans-serif; 
            color: #fff; 
            font-size: 2rem; 
            margin-bottom: 15px; 
            text-transform: uppercase;
            text-shadow: 
                0 0 5px #00d2ff,
                0 0 10px #00d2ff,
                0 0 20px #00d2ff,
                0 0 40px #00d2ff; /* Brilho Ciano */
            animation: flicker 3s infinite alternate;
        }

        h2.subtitle { 
            font-family: 'Raleway', sans-serif;
            font-size: 1.1rem; 
            color: #d1d1d1; 
            font-weight: bold; 
            letter-spacing: 1px;
            text-shadow: 1px 1px 2px #000;
        }

        /* GRID DOS CARDS */
        #character-selection { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
            gap: 30px; 
            max-width: 1200px; 
            margin: 0 auto; 
            padding-bottom: 60px; 
        }

        /* CARD ESTILIZADO */
        .character-card { 
            background-color: rgba(20, 20, 20, 0.8); 
            border: 2px solid #333;
            border-radius: 15px; 
            padding: 15px; 
            text-align: center; 
            box-shadow: 0 0 15px rgba(0,0,0,0.8); 
            transition: all 0.3s ease; 
            display: flex; 
            flex-direction: column; 
            justify-content: space-between; 
            position: relative;
            backdrop-filter: blur(5px);
        }

        /* Efeito Hover no Card (Brilho Rosa/Roxo) */
        .character-card:hover { 
            transform: translateY(-8px) scale(1.02); 
            border-color: #ff00de;
            box-shadow: 0 0 20px #ff00de, inset 0 0 10px rgba(255, 0, 222, 0.2);
            z-index: 10;
        }

        .character-card img { 
            width: 100%; 
            height: 400px; 
            object-fit: cover; 
            object-position: top center; 
            border-radius: 10px; 
            margin-bottom: 15px; 
            border: 1px solid #444;
            filter: grayscale(20%); /* Um pouco desbotado pra dar vibe retro */
            transition: filter 0.3s;
        }

        .character-card:hover img {
            filter: grayscale(0%) contrast(1.1);
        }

        .character-card h2 { 
            font-family: 'Orbitron', sans-serif;
            color: #ffeb3b; 
            font-size: 1.5rem; 
            margin-bottom: 5px; 
            text-shadow: 0 0 5px rgba(255, 235, 59, 0.5);
        }

        .character-card h3 { 
            font-size: 0.9rem; 
            color: #00d2ff; 
            margin-bottom: 12px; 
            font-weight: 700; 
            text-transform: uppercase; 
            letter-spacing: 2px; 
        }

        .character-card p { 
            font-style: italic; 
            color: #e0e0e0; 
            margin-bottom: 25px; 
            font-size: 0.95rem; 
            flex-grow: 1; 
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 5px;
        }
        
        /* BOTÕES ESTILOSOS */
        .choose-button { 
            background: linear-gradient(90deg, #ff00de, #be00ff);
            color: white; 
            border: none; 
            padding: 15px 20px; 
            border-radius: 50px; /* Redondinho */
            cursor: pointer; 
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem; 
            font-weight: bold; 
            width: 100%; 
            transition: all 0.3s; 
            text-transform: uppercase;
            box-shadow: 0 4px 15px rgba(190, 0, 255, 0.4);
        }

        .choose-button:hover:not(:disabled) { 
            background: linear-gradient(90deg, #be00ff, #ff00de);
            box-shadow: 0 0 25px #ff00de;
            letter-spacing: 2px;
        }

        .choose-button:active:not(:disabled) { 
            transform: scale(0.95); 
        }

        /* Botão JÁ ESCOLHIDO (Cinza/Desativado) */
        .choose-button:disabled { 
            background: #222 !important; 
            color: #555 !important; 
            cursor: not-allowed; 
            border: 1px solid #333; 
            box-shadow: none;
        }

        /* --- MODAL DE CONFIRMAÇÃO (FUTURISTA) --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.9); 
            display: flex; justify-content: center; align-items: center;
            z-index: 1000;
            opacity: 0; pointer-events: none; transition: opacity 0.3s ease;
            backdrop-filter: blur(8px);
        }
        .modal-overlay.active { opacity: 1; pointer-events: all; }
        
        .modal-box {
            background-color: #111; 
            border: 2px solid #00d2ff;
            padding: 40px; 
            border-radius: 20px; 
            text-align: center;
            max-width: 90%; 
            width: 450px; 
            box-shadow: 0 0 30px rgba(0, 210, 255, 0.3), inset 0 0 20px rgba(0,0,0,0.8);
            position: relative;
            overflow: hidden;
        }
        
        /* Linha de "scan" decorativa no modal */
        .modal-box::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 5px;
            background: rgba(0, 210, 255, 0.5);
            animation: scanline 2s linear infinite;
        }

        .modal-box h3 { 
            color: #fff; 
            margin-bottom: 20px; 
            font-size: 1.5rem; 
            font-family: 'Orbitron', sans-serif; 
            text-transform: uppercase;
        }

        .modal-box p { color: #bbb; margin-bottom: 30px; font-size: 1.1rem; }
        
        .modal-box strong { 
            color: #ff00de; 
            display: block; 
            font-size: 1.8rem; 
            margin-top: 10px; 
            text-shadow: 0 0 10px #ff00de;
            font-family: 'Orbitron', sans-serif; 
        }
        
        .modal-actions { display: flex; gap: 20px; justify-content: center; }
        
        .modal-btn { 
            padding: 15px 30px; 
            border: none; 
            border-radius: 8px; 
            font-weight: bold; 
            cursor: pointer; 
            font-size: 1rem; 
            flex: 1; 
            font-family: 'Orbitron', sans-serif;
            transition: 0.2s;
        }

        .btn-confirm { 
            background-color: #00d2ff; color: #000; 
            box-shadow: 0 0 15px #00d2ff;
        }
        .btn-confirm:hover { background-color: #fff; box-shadow: 0 0 25px #fff; }

        .btn-cancel { 
            background-color: transparent; color: #ff4444; border: 2px solid #ff4444; 
        }
        .btn-cancel:hover { background-color: #ff4444; color: #fff; box-shadow: 0 0 15px #ff4444; }

        /* ANIMAÇÕES */
        @keyframes flicker {
            0%, 19%, 21%, 23%, 25%, 54%, 56%, 100% { opacity: 1; text-shadow: 0 0 10px #00d2ff, 0 0 20px #00d2ff; }
            20%, 24%, 55% { opacity: 0.5; text-shadow: none; }
        }

        @keyframes scanline {
            0% { top: -10%; }
            100% { top: 110%; }
        }

        @media (min-width: 768px) {
            h1 { font-size: 3.5rem; }
            .character-card img { height: 450px; }
            body { padding: 40px; }
        }
    </style>
</head>
<body>

    <header>
        <h1>Uma Festa de matar!</h1>
        <h2 class="subtitle">Escolha seu personagem sabiamente, não vale pegar o que alguém já pegou hein!</h2>
    </header>

    <main id="character-selection">
        <div class="character-card" data-id="1">
            <h2>Gary Amaral</h2>
            <img src="imgs/personagem1.jpg" alt="Personagem 1">
            <h3>O roqueiro popularzinho</h3>
            <p>“Se tiver música boa, eu tô dentro.”</p>
            <button class="choose-button" data-pdf="fichas/ficha_personagem1.pdf">Escolher</button>
        </div>

        <div class="character-card" data-id="2">
            <h2>Rafael Borges</h2>
            <img src="imgs/personagem2.jpg" alt="Personagem 2">
            <h3>O esportista palmeirense</h3>
            <p>“PARMEEEEERAAAAAAAA.”</p>
            <button class="choose-button" data-pdf="fichas/ficha_personagem2.pdf">Escolher</button>
        </div>

        <div class="character-card" data-id="3">
            <h2>Kevin Tavares</h2>
            <img src="imgs/personagem3.jpg" alt="Personagem 3">
            <h3>O roqueiro esquisito</h3>
            <p>“EI, eu não sou esquisito, quem escreveu essa porcaria?”</p>
            <button class="choose-button" data-pdf="fichas/ficha_personagem3.pdf">Escolher</button>
        </div>

        <div class="character-card" data-id="4">
            <h2>Larissa Mendes</h2>
            <img src="imgs/personagem4.jpg" alt="Personagem 4">
            <h3>A estudiosa</h3>
            <p>“Organização é tudo. Sempre.”</p>
            <button class="choose-button" data-pdf="fichas/ficha_personagem4.pdf">Escolher</button>
        </div>

        <div class="character-card" data-id="5">
            <h2>Marcela Duarte</h2>
            <img src="imgs/personagem5.jpg" alt="Personagem 5">
            <h3>A parceira de estudos da Lari</h3>
            <p>“Se você precisar, eu anoto. Eu sempre anoto tudo.”</p>
            <button class="choose-button" data-pdf="fichas/ficha_personagem5.pdf">Escolher</button>
        </div>

        <div class="character-card" data-id="6">
            <h2>Júlia Fontes</h2>
            <img src="imgs/personagem6.jpg" alt="Personagem 6">
            <h3>A nerd popularzinha</h3>
            <p>“Pois é, só tira essa mão SUJA de perto do meu cabelo”</p>
            <button class="choose-button" data-pdf="fichas/ficha_personagem6.pdf">Escolher</button>
        </div>

        <div class="character-card" data-id="7">
            <h2>Olívia Salles</h2>
            <img src="imgs/personagem7.jpg" alt="Personagem 7">
            <h3>A esquisita da computação</h3>
            <p>“Eu funciono melhor com fone no ouvido e café na mão.”</p>
            <button class="choose-button" data-pdf="fichas/ficha_personagem7.pdf">Escolher</button>
        </div>

        <div class="character-card" data-id="8">
            <h2>Ryan Nunes</h2>
            <img src="imgs/personagem8.jpg" alt="Personagem 8">
            <h3>Melhor amigo da Salles, e tão nerd quanto!</h3>
            <p>“Eu preferia continuar em casa jogando Minecraft”</p>
            <button class="choose-button" data-pdf="fichas/ficha_personagem8.pdf">Escolher</button>
        </div>

        <div class="character-card" data-id="9">
            <h2>Ary Carvalho</h2>
            <img src="imgs/personagem9.jpg" alt="Personagem 9">
            <h3>O NB popular famosinho</h3>
            <p>“Achou que eu ia ficar de fora? Jurou né?”</p>
            <button class="choose-button" data-pdf="fichas/ficha_personagem9.pdf">Escolher</button>
        </div>

        <div class="character-card" data-id="10">
            <h2>Bruno Santana</h2>
            <img src="imgs/personagem10.jpg" alt="Personagem 10">
            <h3>O Gêmeo que precisou levar o irmão</h3>
            <p>“Tudo eu nessa casa”</p>
            <button class="choose-button" data-pdf="fichas/ficha_personagem10.pdf">Escolher</button>
        </div>

        <div class="character-card" data-id="11">
            <h2>Dennis Santana</h2>
            <img src="imgs/personagem11.jpg" alt="Personagem 11">
            <h3>O Gêmeo que preferia ter ficado em casa</h3>
            <p>“Eu realmente não precisava estar aqui.”</p>
            <button class="choose-button" data-pdf="fichas/ficha_personagem11.pdf">Escolher</button>
        </div>

        <div class="character-card" data-id="12">
            <h2>André Lacerda</h2>
            <img src="imgs/personagem12.jpg" alt="Personagem 12">
            <h3>O encrenqueiro que leva as bebidas</h3>
            <p>“Nada que um corote meio quente não resolva”</p>
            <button class="choose-button" data-pdf="fichas/ficha_personagem12.pdf">Escolher</button>
        </div>

    </main>

    <div id="confirmation-modal" class="modal-overlay">
        <div class="modal-box">
            <h3>SYSTEM ALERT</h3>
            <p>Confirme a seleção do alvo:</p>
            <strong id="modal-char-name">Nome do Personagem</strong>
            <br>
            <div class="modal-actions">
                <button id="btn-cancel" class="modal-btn btn-cancel">CANCELAR</button>
                <button id="btn-confirm" class="modal-btn btn-confirm">CONFIRMAR</button>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDSCGoUN1ZKYTUi3cpoc4dI1fPZavu3xhI",
            authDomain: "afestaacabou-6b2f7.firebaseapp.com",
            databaseURL: "https://afestaacabou-6b2f7-default-rtdb.firebaseio.com",
            projectId: "afestaacabou-6b2f7",
            storageBucket: "afestaacabou-6b2f7.firebasestorage.app",
            messagingSenderId: "47826000216",
            appId: "1:47826000216:web:ff3028fb5333e48e24ad2d"
        };

        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.database();

        document.addEventListener('DOMContentLoaded', () => {
            const buttons = document.querySelectorAll('.choose-button');
            
            // Elementos do Modal
            const modal = document.getElementById('confirmation-modal');
            const modalCharName = document.getElementById('modal-char-name');
            const btnConfirm = document.getElementById('btn-confirm');
            const btnCancel = document.getElementById('btn-cancel');

            // Variáveis temporárias
            let pendingSelection = {
                ref: null,
                pdfPath: '',
                buttonElement: null
            };

            // Função visual para desativar botão
            const setButtonState = (btn, isTaken) => {
                if (isTaken) {
                    btn.textContent = 'BLOQUEADO';
                    btn.disabled = true;
                } else {
                    btn.textContent = 'SELECIONAR';
                    btn.disabled = false;
                }
            };

            // Configura cada carta
            buttons.forEach(button => {
                const card = button.closest('.character-card');
                const charId = card.dataset.id;
                const charRef = db.ref('personagens/' + charId);
                const charName = card.querySelector('h2').innerText;

                // 1. OUVINTE EM TEMPO REAL
                charRef.on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data && data.escolhido === true) {
                        setButtonState(button, true);
                        card.style.opacity = "0.5"; // Deixa card meio apagado se já foi
                        card.style.borderColor = "#333";
                        card.style.boxShadow = "none";
                    } else {
                        setButtonState(button, false);
                        card.style.opacity = "1";
                    }
                });

                // 2. CLIQUE NO "ESCOLHER" -> ABRE O MODAL
                button.addEventListener('click', (event) => {
                    pendingSelection.ref = charRef;
                    pendingSelection.pdfPath = event.target.dataset.pdf;
                    pendingSelection.buttonElement = button;
                    
                    modalCharName.textContent = charName;
                    modal.classList.add('active');
                });
            });

            // 3. LÓGICA DO MODAL
            btnCancel.addEventListener('click', () => {
                modal.classList.remove('active');
                pendingSelection = { ref: null, pdfPath: '', buttonElement: null }; 
            });

            btnConfirm.addEventListener('click', () => {
                if (!pendingSelection.ref) return;

                const { ref, pdfPath } = pendingSelection;
                modal.classList.remove('active');

                ref.transaction((currentData) => {
                    if (currentData && currentData.escolhido) {
                        return; 
                    }
                    return { escolhido: true }; 
                }, (error, committed, snapshot) => {
                    if (error) {
                        alert('ERRO DE SISTEMA: Conexão falhou!');
                    } else if (!committed) {
                        alert('ALERTA: Alvo já capturado por outro usuário!');
                    } else {
                        alert('SUCESSO: Personagem vinculado! Baixando dados...');
                        const link = document.createElement('a');
                        link.href = pdfPath;
                        link.download = pdfPath.split('/').pop();
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                    }
                });
            });
        });
    </script>
</body>
</html>